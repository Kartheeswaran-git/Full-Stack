{% extends "base.html" %}

{% block extra_css %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
<style>
    /* Your existing styles */
    .status-cell { font-weight: 500; text-transform: capitalize; }
    .status-cell.present { color: #2ecc71; }
    .status-cell.absent { color: #e74c3c; }
    .status-cell.unmarked { color: #95a5a6; }
    .status-cell.saving { color: #3498db; font-style: italic; }
    .status-cell.error { color: #e74c3c; font-weight: bold; }
    
    .prediction-cell { min-width: 120px; }
    .prediction-loading { color: #7f8c8d; font-style: italic; }
    
    .prediction-result {
        position: relative;
        padding: 4px 8px;
        border-radius: 4px;
        overflow: hidden;
    }
    /* Add more styles as needed */
</style>
{% endblock %}

{% block content %}
<div class="attendance-management">
    <div class="card">
        <h2>Select Date</h2>
        <div class="form-group">
            <label for="attendance-date">Date</label>
            <input type="date" id="attendance-date" 
                   value="{{ date }}"
                   min="2023-01-01" 
                   max="{{ today }}">
        </div>
    </div>

    <div class="card full-width">
        <h2>Attendance for <span id="selected-date">
            {% if date == today %}
                Today
            {% else %}
                {{ date }}
            {% endif %}
        </span></h2>
        
        <div class="table-responsive">
            <table id="attendance-table">
                <thead>
                    <tr>
                        <th>Student ID</th>
                        <th>Name</th>
                        <th>Status</th>
                        <th>AI Prediction</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for student in students %}
                    {% set student_att = attendance|selectattr('student_id', 'equalto', student.id)|first %}
                    <tr data-student-id="{{ student.id }}">
                        <td>{{ student.id }}</td>
                        <td>{{ student.name }}</td>
                        <td class="status-cell {{ student_att.status if student_att else 'unmarked' }}">
                            {{ student_att.status if student_att else 'unmarked' }}
                        </td>
                        <td class="prediction-cell">
                            <div class="prediction-loading">Loading...</div>
                        </td>
                        <td class="action-cell">
                            <button class="mark-btn present" 
                                    data-student-id="{{ student.id }}">Present</button>
                            <button class="mark-btn absent" 
                                    data-student-id="{{ student.id }}">Absent</button>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script src="{{ url_for('static', filename='js/attendance.js') }}"></script>
{% endblock %}